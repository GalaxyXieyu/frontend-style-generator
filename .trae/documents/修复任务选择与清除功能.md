# 修复任务选择与清除功能

## 问题描述

用户在任务队列弹窗中无法选中任务进行清除，"清除已完成"按钮会清除所有已完成的任务，而不是清除选中的任务。

## 解决方案

### 1. 前端改动 (popup.js)

#### 添加任务选择功能
- 在 `PopupController` 构造函数中添加 `selectedTasks` 属性（Set 类型）用于存储选中的任务 ID
- 在每个任务项中添加复选框，允许用户选择任务
- 复选框状态会同步到 `selectedTasks` 集合中

#### 新增方法

**`clearSelected()`** - 清除选中的任务
- 检查是否有选中的任务
- 弹出确认对话框
- 逐个删除选中的任务（发送 DELETE_TASK 消息）
- 清空选择状态并刷新列表

**`toggleSelectAll()`** - 全选/取消全选
- 如果已全选则清空选择
- 否则选中所有任务

**`updateClearButton()`** - 更新清除按钮文本
- 当有选中任务时显示"清除选中 (N)"
- 否则显示"清除已完成"

#### UI 改进
- 为每个任务项添加复选框（16x16px）
- 复选框点击时更新选择状态和按钮文本
- 修复了任务项中状态文本重复显示的问题

### 2. 后端改动 (task-manager.js)

#### 新增方法

**`deleteTask(taskId)`** - 删除指定任务
- 从队列中移除任务
- 从任务列表中删除
- 保存更改并通知更新

#### 新增消息处理
- 添加 `DELETE_TASK` 消息处理，调用 `deleteTask()` 方法

### 3. HTML 改动 (popup.html)

- 在任务队列弹窗底部添加"全选"按钮
- 按钮包含复选框图标和"全选"文本

## 使用方法

1. **选择任务**：点击任务项前面的复选框
2. **全选/取消全选**：点击底部的"全选"按钮
3. **清除选中任务**：
   - 选中一个或多个任务
   - 点击"清除选中 (N)"按钮
   - 确认后删除选中的任务
4. **清除所有已完成任务**：不选择任何任务时，点击"清除已完成"按钮

## 改进说明

### 原有逻辑
- "清除已完成"按钮会删除所有状态为 `completed` 的任务
- 无法选择性删除任务

### 新逻辑
- 用户可以通过复选框选择要删除的任务
- "清除已完成"按钮变为"清除选中"按钮，只删除选中的任务
- 添加"全选"按钮快速选择所有任务
- 按钮文本会动态显示选中的任务数量

## 文件改动列表

1. `/chrome-extension/popup/popup.js` - 添加任务选择和删除逻辑
2. `/chrome-extension/popup/popup.html` - 添加全选按钮
3. `/chrome-extension/background/task-manager.js` - 添加 deleteTask 方法和消息处理
4. `/chrome-extension/options/js/utils/storage.js` - 添加 clearAllData 方法（前一个 bug 修复）

## 测试建议

1. 创建多个任务
2. 测试选择单个任务并清除
3. 测试全选后清除所有任务
4. 测试部分选择后清除
5. 测试不选择任何任务时按钮的行为
